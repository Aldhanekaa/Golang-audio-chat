name: Golang
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up Go 1.18
        uses: actions/setup-go@v1
        with:
          go-version: 1.18

      - name: Deploy App and Deploy
        uses: appleboy/ssh-action@v0.1.2

        with:
          host: ${{secrets.SSH_HOST}} # IP address of the server you wish to ssh into
          key: ${{secrets.SSH_KEY}} # Private or public key of the server
          username: ${{ secrets.SSH_USERNAME }} # User of the server you want to ssh into

          script: |

            export NVM_DIR=~/.nvm
            source ~/.nvm/nvm.sh    

            export GO_DIR=/usr/local/go
            # source /usr/local/go/bin/go

            echo $PATH


            cd /root
            cd go
            cd deploying

            echo "Cloning Git Repo to /root/deploying"
            git clone https://aldhanekaa:${{secrets.GITHUB_TOKEN}}@github.com/aldhanekaa/Golang-audio-chat.git

            cd Golang-audio-chat

            # chmod +x ./deploy.sh

            # ./deploy.sh
